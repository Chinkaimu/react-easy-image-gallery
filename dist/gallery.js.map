{"version":3,"sources":["../src/gallery.js"],"names":[],"mappings":"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","file":"gallery.js","sourcesContent":["import React, { Component } from 'react';\r\nimport styled from 'styled-components';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst ImgList = styled.div`\r\n  overflow: hidden;\r\n`;\r\n\r\nconst ImgWrapper = styled.div`\r\n  display: inline-block;\r\n  vertical-align: top;\r\n  margin: 5px;\r\n  box-sizing: border-box;\r\n  overflow: hidden;\r\n  background: ${props => props.bgColor};\r\n`;\r\n\r\nconst Img = styled.img`\r\n  width: 100%;\r\n  height: 100%;\r\n`;\r\n\r\nexport default class Gallery extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.myRef = React.createRef();\r\n    this.updateOnResize = this.updateOnResize.bind(this);\r\n\r\n    this.debouncedResize = debounce(this.updateOnResize, 100);\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('resize', this.debouncedResize);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('resize', this.debouncedResize);\r\n  }\r\n\r\n  updateOnResize() {\r\n    if (this.isAspectRatioSame()) {\r\n      return;\r\n    }\r\n\r\n    if (this.timeout) {\r\n      window.cancelAnimationFrame(this.timeout);\r\n    }\r\n\r\n    this.timeout = window.requestAnimationFrame(() => {\r\n      this.forceUpdate();\r\n    });\r\n  }\r\n\r\n  isAspectRatioSame() {\r\n    if (this.myRef.current) {\r\n      return this.rowTotalAspectRatio === this.myRef.current.clientWidth / this.props.columnWidth;\r\n    }\r\n  }\r\n\r\n  scrollbarIsAboutToAppear() {\r\n    const { images } = this.props;\r\n    const scrollbarIsHidden = window.innerWidth === document.body.clientWidth;\r\n\r\n    if (scrollbarIsHidden) {\r\n      const totalHeight = images.reduce((a, b) => { return a + b.height }, 0);\r\n      if (totalHeight > window.innerHeight - this.myRef.current.offsetTop) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  renderImages() {\r\n    const { images, columnWidth } = this.props;\r\n    \r\n    let containerWidth = this.myRef.current.clientWidth;\r\n\r\n    if (this.scrollbarIsAboutToAppear(images, this.myRef)) {\r\n      containerWidth -= getScrollbarWidth();\r\n    }\r\n\r\n    this.rowTotalAspectRatio = containerWidth / columnWidth;\r\n    const result = [];\r\n    let currentRow = [];\r\n    let currentRowAspectRatio = 0;\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      const image = images[i];\r\n      const aspectRatio = image.width / image.height;\r\n\r\n      currentRowAspectRatio += aspectRatio;\r\n      currentRow.push([\r\n        <ImgWrapper key={i} bgColor={this.props.imageLoadingColor}>\r\n          <Img src={image.src} />\r\n        </ImgWrapper>,\r\n        aspectRatio\r\n      ]);\r\n      if (currentRowAspectRatio > this.rowTotalAspectRatio || images[i + 1] === undefined) {\r\n        const rowAspectRatio = currentRowAspectRatio > this.rowTotalAspectRatio ? currentRowAspectRatio : this.rowTotalAspectRatio;\r\n\r\n        for (let j = 0; j < currentRow.length; j++) {\r\n          const Element = currentRow[j][0];\r\n          const aspectRatio = currentRow[j][1];\r\n          const workingWidth = containerWidth - (10 * currentRow.length);\r\n          const width = (aspectRatio * workingWidth / rowAspectRatio);\r\n          const height = width / aspectRatio;\r\n          result.push(\r\n            React.cloneElement(\r\n              Element, \r\n              { style: { width, height } }\r\n            )\r\n          );\r\n        }\r\n\r\n        currentRowAspectRatio = 0;\r\n        currentRow = [];\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ImgList ref={this.myRef}>\r\n        { this.myRef.current && this.renderImages() }\r\n      </ImgList>\r\n    );\r\n  }\r\n}\r\n\r\nGallery.propTypes = {\r\n  images: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      src: PropTypes.string.isRequired,\r\n      width: PropTypes.number.isRequired,\r\n      height: PropTypes.number.isRequired\r\n    })\r\n  ).isRequired,\r\n  columnWidth: PropTypes.number,\r\n  imageLoadingColor: PropTypes.string\r\n};\r\n\r\nGallery.defaultProps = {\r\n  columnWidth: 250,\r\n  imageLoadingColor: '#f3f3f3'\r\n};\r\n\r\nfunction getScrollbarWidth() {\r\n  return 17;\r\n}\r\n\r\nfunction debounce(fn, ms) {\r\n  let debounceTimeout;\r\n  let timeSinceLastCalledFn;\r\n\r\n  return (...args) => {\r\n    if (debounceTimeout) {\r\n      clearTimeout(debounceTimeout);\r\n    }\r\n\r\n    debounceTimeout = setTimeout(() => {\r\n      fn.apply(null, args);\r\n    }, ms);\r\n  }\r\n}"]}